@model HomeVM
@using DevExpress.Web.Mvc.UI;
@using DevExpress.Web.Mvc;
@using System.Web.UI.WebControls;
@{
	Layout = "";
}
<html>
<head>
	<script src="@Url.Content("~/Scripts/jquery-1.11.0.min.js")" type="text/javascript"></script>
	<link rel="stylesheet" href="@Url.Content("~/MapTest/leaflet.css")" />
	<link rel="stylesheet" href="@Url.Content("~/MapTest/leaflet.iconlabel.css")" />
	<link rel="stylesheet" href="@Url.Content("~/MapTest/leaflet.label.css")" />
	<script type="text/javascript" src="@Url.Content("~/MapTest/leaflet.js")"></script>
	<!-- Leaflet MiniMap Plugins -->
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.2&sensor=true"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/leaflet-google.js")"></script>
	<!-- ### Leaflet MiniMap Plugins -->
	<!-- Leaflet Element Label Plugins -->
	<script type="text/javascript" src="@Url.Content("~/MapTest/leaflet.iconlabel.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/Label.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/BaseMarkerMethods.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/Marker.Label.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/CircleMarker.Label.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/Path.Label.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/Map.Label.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/FeatureGroup.Label.js")"></script>
	<!-- ### Leaflet Element Label Plugins -->
	<!-- Leaflet MarkerCluster Plugins -->
	<link rel="stylesheet" href="@Url.Content("~/MapTest/MarkerCluster.css")" />
	<link rel="stylesheet" href="@Url.Content("~/MapTest/MarkerCluster.Default.css")" />
	<script type="text/javascript" src="@Url.Content("~/MapTest/leaflet.markercluster-src.js")"></script>
	<!-- ### Leaflet MarkerCluster Plugins -->
	<!-- Leaflet Awesome Markers Plugins -->
	<link rel="stylesheet" href="@Url.Content("~/MapTest/font-awesome.css")" />
	<link rel="stylesheet" href="@Url.Content("~/MapTest/leaflet.awesome-markers.css")"/>
	<script type="text/javascript" src="@Url.Content("~/MapTest/leaflet.awesome-markers.js")"></script>
	<!-- ### Leaflet MiniMap Plugins -->
	<!--DATA TEMP-->
	<script type="text/javascript" src="@Url.Content("~/MapTest/mines.js")"></script>
	<!-- Leaflet MiniMap Plugins -->
	<link rel="stylesheet" href="@Url.Content("~/MapTest/Control.MiniMap.css")" />
	<script  type="text/javascript"src="@Url.Content("~/MapTest/Control.MiniMap.js")"></script>
	<!-- ### Leaflet MiniMap Plugins -->
	<!-- Leaflet Routing Plugins -->
	<link rel="stylesheet" href="@Url.Content("~/MapTest/Routing/leaflet-routing-machine.css")" />
	<script type="text/javascript" src="@Url.Content("~/MapTest/Routing/leaflet-routing-machine.min.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/Routing/L.Routing.OSRM.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/Routing/L.Routing.Line.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/Routing/L.Routing.Itinerary.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/Routing/L.Routing.Plan.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/Routing/L.Routing.Control.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/Routing/Control.Geocoder.js")"></script>
	<!-- ### Leaflet Routing Plugins -->
	<!-- Leaflet SideBar Plugins -->
	<link rel="stylesheet" href="@Url.Content("~/MapTest/SideBar/L.Control.Sidebar.css")" />
	<script type="text/javascript" src="@Url.Content("~/MapTest/SideBar/L.Control.Sidebar.js")"></script>
	<!-- ### Leaflet SideBar Plugins -->
	<!-- Leaflet PolyLineText Plugins -->
	<script type="text/javascript" src="@Url.Content("~/MapTest/PolyLineText/leaflet.textpath.js")"></script>
	<!-- ### Leaflet PolyLineText Plugins -->
	<!-- Leaflet PolylineDecorator Plugins -->
	<script type="text/javascript" src="@Url.Content("~/MapTest/PolylineDecorator/L.LineUtil.PolylineDecorator.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/PolylineDecorator/L.RotatedMarker.js")")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/PolylineDecorator/L.Symbol.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/PolylineDecorator/L.PolylineDecorator.js")"></script>
	<!-- ### Leaflet PolylineDecorator Plugins -->
	<!-- Leaflet Measure Distance Plugins -->
	<link rel="stylesheet" href="@Url.Content("~/MapTest/Distance/distance.css")" />
	<link rel="stylesheet" href="@Url.Content("~/MapTest/Distance/leaflet.draw.css")" />
	<script type="text/javascript" src="@Url.Content("~/MapTest/Distance/leaflet.draw.js")"></script>
	<script type="text/javascript" src="@Url.Content("~/MapTest/Distance/Distance.js")"></script>
	<!-- ### Leaflet Measure Distance Plugins -->
	<!-- DateTime Picker -->
	<link href="@Url.Content("~/Content/THP/css/jquery-ui-1.8.17.css")" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="@Url.Content("~/Content/THP/js/jquery-ui-1.8.17.min.js")"></script>
	<!-- ### DateTime Picker -->
	<script type="text/javascript" src="@Url.Content("~/Content/THP/js/jquery.price_format.1.8.js")"></script>
	<style>
		html, body {
			margin: 0;
			padding: 0;
			height: 100%;
		}

		#map {
			width: 100%;
			height: 100%;
		}

		.leaflet-control-attribution {
			display: none;
		}

		a[href^="http://maps.google.com/maps"] {
			display: none !important;
		}

		.gmnoprint a, .gmnoprint span {
			display: none;
		}

		.gmnoprint div {
			background: none !important;
		}

		.info {
			padding: 6px 8px;
			font: 14px/16px Arial, Helvetica, sans-serif;
			background: white;
			background: rgba(255,255,255,0.8);
			box-shadow: 0 0 15px rgba(0,0,0,0.2);
			border-radius: 5px;
		}

			.info h4 {
				margin: 0 0 5px;
				color: #777;
			}

		.legend {
			line-height: 18px;
			color: #555;
		}

			.legend i {
				width: 18px;
				height: 18px;
				float: left;
				margin-right: 8px;
				opacity: 0.7;
			}

		#tbInfo th tr td {
			white-space: nowrap;
		}
	</style>
</head>
<body>
	<div id="map">
	</div>
	<div id="container">
		<div id="loading" class="loading">
		</div>
		<script type='text/javascript'>
			////Map Utility     
			$("form#frmMap").error(function () {
				alert("form Error!!!");
				window.location = window.location;
			});

			$('.number').priceFormat({
				prefix: '',
				centsSeparator: '.',
				thousandsSeparator: ',',
				centsLimit: 0
			});
			$('.number').css("text-align", "right");

			$(document).ajaxStart(function () {
				$("#loading").show();
			});
			$(document).ajaxStop(function () {
				$("#loading").hide();
			});
			$(document).ajaxError(function () {
				//alert("ajax có vấn đề");
			});

			//Get color %
			function getColor(d) {
				if (d >= 0 && d <= 20) {
					return '0213EA';
				}
				if (d >= 21 && d <= 40) {
					return '0FF608';
				}
				if (d >= 41 && d <= 60) {
					return 'FFFD01';
				}
				if (d >= 61 && d <= 80) {
					return 'FEB101';
				}
				if (d >= 81 && d <= 100) {
					return 'FF1200';
				}
			};

			////##Map Utility     

			////DATA USE IN MAP
			var strVisitDate = '';
			var mapData = {};
			mapData.LatLongBounds = [];
			////##DATA USE IN MAP

			////INIT GOOGLE MAP
			var map = new L.Map('map', {
				center: [16, 106],
				zoom: 7,
				minZoom: 0,
				maxZoom: 23
			});
			var googleLayer = new L.Google('ROADMAP');
			map.addLayer(googleLayer);

			//legend
			var legend = L.control({
				position: 'topright'
			});
			legend.onAdd = function (map) {
				var div = L.DomUtil.create('div', 'info legend'),
				grades = [0, 20, 40, 60, 80, 100],
				labels = [],
				from, to;
				for (var i = 0; i < grades.length - 1; i++) {
					from = grades[i] + 1;
					to = grades[i + 1];
					labels.push(
					'<img width="5px" id=img' + getColor(from + 1) + ' style="float:left;margin-top:5px;margin-right:2px" src="/Content/img/m_arrow_w.png"/><i style="background:#' + getColor(from + 1) + '"></i> ' +
					from + (to ? '&ndash;' + to : ''));
				}
				div.innerHTML = labels.join('<br>');
				return div;
			};
			legend.addTo(map);
			////##INIT GOOGLE MAP

			//        var polygon = L.multiPolygon([
			//				[[-37.7599, 175.2515], [-37.7599, 175.2595], [-37.7653, 175.2595], [-37.7653, 175.2515], [-37.7599, 175.2515]]
			//			]);
			//        polygon.bindLabel(strLabel)
			//		.addTo(map);

			//        var label = new L.Label();
			//        label.setContent("MultiPolygon static label");
			//        label.setLatLng(polygon.getBounds().getCenter());
			//        map.showLabel(label);
			var LatLongBoundMaps = [];
			function RenderOutletPolygon(TerritoryID) {
				var LatLongBounds = [];
				var LatLongBoundsCenter = [];
				$.ajax({ //Process the form using $.ajax()
					type: 'POST', //Method type
					url: '/DashBoard/GetOutletPolygon', //Your form processing file url
					data: { TerritoryID: TerritoryID }, //Forms name
					dataType: 'json',
					success: function (data) {
						if (data != null && data.html != null && data.html.length > 1) {
							var n = data.html.length;
							var nCenterFrom = (n / 4) - 1;
							var nCenterTo = (n / 4) + 1;
							var mCenterFrom = nCenterFrom + (n / 2) - 1;
							var mCenterTo = nCenterTo + (n / 2) - 1;
							for (var i = 0; i < n; i++) {
								var latlng = L.latLng(data.html[i].Lat, data.html[i].Lng);
								LatLongBounds.push(latlng);
								LatLongBoundMaps.push(latlng);

								//var marker = L.marker(latlng).addTo(map);
								if (i >= nCenterFrom && i <= nCenterTo) {
									LatLongBoundsCenter.push(latlng);
								}
								else if (i >= mCenterFrom && i <= mCenterTo) {
									LatLongBoundsCenter.push(latlng);
								}
							}

							var strLabel = '';
							if (data.info != null) {
								strLabel += data.info.Code + ' - ' + data.info.Name + '<br/>';
								strLabel += '<table style="width:100%" id="tbInfo" >';
								//strLabel += '<caption>' + data.info.Code + ' - ' + data.info.Name + '</caption>';
								strLabel += '<tr>';
								strLabel += '<td nowrap>@Utility.Phrase("OutletMustVisit")</td>';
								strLabel += '<td nowrap>' + data.info.OutletMustVisit + '</td>';
								strLabel += '</tr>';
								strLabel += '<tr>';
								strLabel += '<td nowrap>@Utility.Phrase("OutletVisited")</td>';
								strLabel += '<td nowrap>' + data.info.OutletVisited + '</td>';
								strLabel += '</tr>';
								strLabel += '<tr>';
								strLabel += '<td nowrap>@Utility.Phrase("OrderCount")</td>';
								strLabel += '<td nowrap>' + data.info.OrderCount + '</td>';
								strLabel += '</tr>';
								strLabel += '<tr>';
								strLabel += '<td nowrap>@Utility.Phrase("SOMCP")</td>';
								strLabel += '<td nowrap>' + data.info.SOMCP + ' %</td>';
								strLabel += '</tr>';
								strLabel += '<tr>';
								strLabel += '<td nowrap>@Utility.Phrase("VisitMCP")</td>';
								strLabel += '<td nowrap>' + data.info.VisitMCP + ' %</td>';
								strLabel += '</tr>';
								strLabel += '</table>';

							    //Math.floor((Math.random() * 100) + 1)
								var polygon = L.multiPolygon([LatLongBounds], { color: '#' + getColor(data.info.VisitMCP), weight: '4px' });
								polygon.bindLabel(strLabel)
                                .addTo(map);

								var bounds = L.latLngBounds(LatLongBoundsCenter);
								var label = new L.Label();
								label.setContent(data.info.Code + ' - ' + data.info.Name);// + " " + n.toString());
								label.setLatLng(bounds.getCenter());
								map.showLabel(label);

								var boundsMap = L.latLngBounds(LatLongBoundMaps);
							    //map.fitBounds(polygon.getBounds());
								map.fitBounds(boundsMap);
							}
						}
					}
				});
			}

			//RenderOutletPolygon('');
			//RenderOutletPolygon('MB');
			//RenderOutletPolygon('MN');

			//RenderOutletPolygon('BMT');
			//RenderOutletPolygon('DB');
			//RenderOutletPolygon('HCM');
			//RenderOutletPolygon('HN');
			//RenderOutletPolygon('MD');
			//RenderOutletPolygon('MT');
			//RenderOutletPolygon('NMT');
			//RenderOutletPolygon('TB');

			//RenderOutletPolygon('BMT1');
			//RenderOutletPolygon('BMT2');
			//RenderOutletPolygon('BMT3');
			//RenderOutletPolygon('DB1');
			//RenderOutletPolygon('DB2');
			//RenderOutletPolygon('DB3');
			//RenderOutletPolygon('HCM1');
			//RenderOutletPolygon('HCM2');
			//RenderOutletPolygon('HCM3');
			//RenderOutletPolygon('HCM4');
			//RenderOutletPolygon('HN1');
			//RenderOutletPolygon('HN2');
			//RenderOutletPolygon('HN3');
			//RenderOutletPolygon('HN4');
			//RenderOutletPolygon('MD1');
			//RenderOutletPolygon('MD2');
			//RenderOutletPolygon('MD3');
			//RenderOutletPolygon('MD4');
			//RenderOutletPolygon('MT1');
			//RenderOutletPolygon('MT2');
			//RenderOutletPolygon('MT3');
			//RenderOutletPolygon('MT4');
			//RenderOutletPolygon('MT5');
			//RenderOutletPolygon('NMT1');
			//RenderOutletPolygon('NMT2');
			//RenderOutletPolygon('NMT3');
			//RenderOutletPolygon('NMT4');
			//RenderOutletPolygon('TB1');
			//RenderOutletPolygon('TB2');
			//RenderOutletPolygon('TB3');

			//RenderOutletPolygon('10000534'); 
			//RenderOutletPolygon('10001241'); 
			//RenderOutletPolygon('10000535'); 
			//RenderOutletPolygon('10001318'); 
			//RenderOutletPolygon('10001397'); 
			//RenderOutletPolygon('10001394'); 

		</script>
		<script type="text/javascript" src="@Url.Action("ReportOrderIndexLevelTerritory", "DashBoard")"></script>
		<script type="text/javascript">
			//var boundsMap = L.latLngBounds(LatLongBoundMaps);
			//map.fitBounds(polygon.getBounds());
			//map.fitBounds(boundsMap);
		</script>
	</div>
</body>
</html>
